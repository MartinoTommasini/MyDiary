
# This file was *autogenerated* from the file ./brute_messages.sage
from sage.all_cmdline import *   # import sage library

_sage_const_2 = Integer(2); _sage_const_1 = Integer(1); _sage_const_0 = Integer(0); _sage_const_5 = Integer(5); _sage_const_10000 = Integer(10000); _sage_const_16 = Integer(16); _sage_const_20 = Integer(20); _sage_const_1608584 = Integer(1608584)#!/usr/bin/env sage
import sys, requests, re, hashlib
from sage.all import factor

hashlen = _sage_const_5 

url, auth = 'http://131.155.21.174:8081', ('', 'ilovecrypto')
sid, token = _sage_const_1608584 , '9c593b9cff2bb86750728edca1d4e203b20ee451'

sha = lambda m: int(hashlib.sha256((str(sid) + m).encode()).hexdigest()[:_sage_const_2 *hashlen],_sage_const_16 )

req = requests.Session()
req.cookies['token'] = token

r = req.get(url+'/', auth=auth)
n = int(re.search('n = ([0-9]+)', r.text).groups()[_sage_const_0 ])
e = int(re.search('e = ([0-9]+)', r.text).groups()[_sage_const_0 ])


def sign(m):
    r = req.post(url+'/sign', auth=auth, data={'msg': m})
    return int(r.text)

def validate(m, s):
    return pow(s, e, n) == sha(m)

def forgery(m, s):  # use this to submit your forgery once you've created it
    assert validate(m, s)
    r = req.post(url+'/validate_forgery', auth=auth, data={'msg': m, 'sig': str(s)})
    print('\x1b[32m{}\x1b[0m'.format(r.text.strip()))

################################################################



print('public key: {}'.format((n,e)))

# Find messages that factor in the factor base 
factor_base= _sage_const_10000 
voc = "abcdefghijklmnopqrstuvwyz1234567890;:+*+"
base=""
cont=_sage_const_0 

for a in voc:
    for x in voc:
        message = base + x
        # compute sha
        hashed = sha(message)
        if factor(hashed)[-_sage_const_1 ][_sage_const_0 ] <= factor_base:
            print(message)
            print(cont)
            print(hashed)
            print(factor(hashed))
            cont += _sage_const_1 
            print("-"*_sage_const_20 )

        # check if factoror of hash is smooth
        # if yes, save in a list.
        
        #exit program when (primes in factor base) + 1 hashes are found
    base = base + a
        
    
#sig = sign(msg)
#print('signature: {}'.format(sig))
#print('is valid? {}'.format(validate(msg, sig)))

